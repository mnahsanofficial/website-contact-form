<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Website Contact Form</title>
    <link rel="stylesheet" href="./dist/style.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f8fafc;
        }
        
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .debug-log {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Debug Mode - Contact Form</h1>
        
        <div id="status" class="status info">
            üîÑ Initializing debug mode...
        </div>
        
        <div class="debug-log" id="debug-log">
            Starting debug session...<br>
        </div>
        
        <!-- Contact form will be mounted here -->
        <div id="contact"></div>
        
        <hr style="margin: 2rem 0; border: none; border-top: 1px solid #e5e7eb;">
        
        <h2>Debug Information</h2>
        <div id="debug-info">
            <p><strong>ClassicEditor available:</strong> <span id="ckeditor-status">Checking...</span></p>
            <p><strong>WebsiteContactForm available:</strong> <span id="library-status">Checking...</span></p>
            <p><strong>EmailJS available:</strong> <span id="emailjs-status">Checking...</span></p>
        </div>
    </div>

    <!-- Load dependencies from CDN -->
    <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/ckeditor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    
    <!-- Load our library -->
    <script src="./dist/index.umd.js"></script>
    
    <script>
        // Debug logging
        const debugLog = document.getElementById('debug-log');
        const statusDiv = document.getElementById('status');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type = 'info') {
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }
        
        // Check dependencies
        function checkDependencies() {
            log('Checking dependencies...');
            
            // Check CKEditor
            const ckeditorEl = document.getElementById('ckeditor-status');
            if (typeof ClassicEditor !== 'undefined') {
                ckeditorEl.innerHTML = '‚úÖ Available';
                ckeditorEl.style.color = 'green';
                log('‚úÖ CKEditor ClassicEditor is available');
            } else {
                ckeditorEl.innerHTML = '‚ùå Not available';
                ckeditorEl.style.color = 'red';
                log('‚ùå CKEditor ClassicEditor is NOT available');
            }
            
            // Check our library
            const libraryEl = document.getElementById('library-status');
            if (typeof WebsiteContactForm !== 'undefined') {
                libraryEl.innerHTML = '‚úÖ Available';
                libraryEl.style.color = 'green';
                log('‚úÖ WebsiteContactForm library is available');
            } else {
                libraryEl.innerHTML = '‚ùå Not available';
                libraryEl.style.color = 'red';
                log('‚ùå WebsiteContactForm library is NOT available');
            }
            
            // Check EmailJS
            const emailjsEl = document.getElementById('emailjs-status');
            if (typeof emailjs !== 'undefined') {
                emailjsEl.innerHTML = '‚úÖ Available';
                emailjsEl.style.color = 'green';
                log('‚úÖ EmailJS is available');
            } else {
                emailjsEl.innerHTML = '‚ùå Not available';
                emailjsEl.style.color = 'red';
                log('‚ùå EmailJS is NOT available');
            }
        }
        
        // Initialize contact form with detailed logging
        async function initContactForm() {
            log('Starting contact form initialization...');
            setStatus('üîÑ Initializing contact form...', 'info');
            
            try {
                if (typeof WebsiteContactForm === 'undefined') {
                    throw new Error('WebsiteContactForm library not loaded');
                }
                
                if (typeof ClassicEditor === 'undefined') {
                    throw new Error('CKEditor ClassicEditor not available');
                }
                
                log('Creating contact form...');
                const form = await WebsiteContactForm.createContactForm({
                    target: '#contact',
                    theme: 'light',
                    labels: {
                        title: 'Debug Contact Form',
                        name: 'Your Name',
                        email: 'Email Address',
                        message: 'Your Message (CKEditor)'
                    },
                    placeholders: {
                        name: 'Enter your name',
                        email: 'your.email@example.com',
                        message: 'Try the enhanced rich text editor with headings, colors, tables, lists, and more formatting options!'
                    },
                    buttonText: 'Test Submit',
                    onSubmit: (data) => {
                        log('üéâ Form submitted successfully!');
                        log('Form data:');
                        log(`- Name: ${data.name}`);
                        log(`- Email: ${data.email}`);
                        log(`- HTML: ${data.messageHtml}`);
                        log(`- Text: ${data.messageText}`);
                        
                        setStatus('‚úÖ Form submitted successfully! Check debug log for data.', 'success');
                        alert('Form submitted! Check the debug log above for form data.');
                    },
                    onSuccessMessage: 'üéâ Message sent successfully!',
                    onErrorMessage: '‚ùå Failed to send message.'
                });
                
                log('‚úÖ Contact form initialized successfully!');
                setStatus('‚úÖ Contact form ready! Try typing in the message field.', 'success');
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                setStatus(`‚ùå Failed to initialize: ${error.message}`, 'error');
                
                document.getElementById('contact').innerHTML = 
                    `<div style="color: red; text-align: center; padding: 2rem;">
                        <h3>Failed to load contact form</h3>
                        <p>Error: ${error.message}</p>
                        <p>Check the debug log above for details.</p>
                    </div>`;
            }
        }
        
        // Wait for all scripts to load
        let checkCount = 0;
        const maxChecks = 50; // 5 seconds max
        
        function waitForDependencies() {
            checkCount++;
            log(`Dependency check ${checkCount}/${maxChecks}`);
            
            if (typeof ClassicEditor !== 'undefined' && typeof WebsiteContactForm !== 'undefined') {
                log('All dependencies loaded, initializing form...');
                checkDependencies();
                initContactForm();
            } else if (checkCount < maxChecks) {
                setTimeout(waitForDependencies, 100);
            } else {
                log('‚ùå Timeout waiting for dependencies');
                setStatus('‚ùå Timeout waiting for dependencies to load', 'error');
                checkDependencies();
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM ready, waiting for dependencies...');
            setTimeout(waitForDependencies, 100);
        });
    </script>
</body>
</html>
